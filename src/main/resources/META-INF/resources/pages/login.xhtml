<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <f:facet name="first">
        <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <meta name="viewport"
              content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
        <meta name="apple-mobile-web-app-capable" content="yes"/>
        <link rel="icon" type="image/png" href="assets/pandora-layout/images/favicon-32x32.png"/>
    </f:facet>

    <title>Login</title>

    <script type="text/javascript">
		$(function() {
			var loginForms = $('.login-forms');
			var login = $('.login');
			var register = $('.register');

			$('.tab').on('click', function(e) {
				var tab = $(this);
				tab.siblings('.active-tab').removeClass('active-tab');
				tab.addClass('active-tab');

				if (tab.hasClass('tab-1')) {
					loginForms.css('transform', 'translate3d(0, 0, 0)');
					login.css('opacity', '1');
					register.css('opacity', '0');

				} else if (tab.hasClass('tab-2')) {
					loginForms.css('transform', 'translate3d(-100%, 0, 0)');
					login.css('opacity', '0');
					register.css('opacity', '1');
				}
				e.preventDefault();
			});
		});















    </script>
</h:head>

<h:body styleClass="login-body">
    <p:growl id="growl" showDetail="true"/>
    <div class="login-wrapper">
        <div class="login-panel">
            <div class="login-title">
                <h4>Login a Capitalsys-ERP</h4>
                <span> Bienvenido, por favor usa el formulario para
					loguearte. </span>
            </div>
            <h:form id="loginForm" class="login-forms-wrapper">
                <div class="form-tabs">
                    <div class="tab tab-1 active-tab">LOGIN</div>
                </div>
                <div class="login-forms">
                    <div class="login-form login">
                        <div class="form-group">
                            <span>Usuario</span>
                            <p:inputText placeholder="username" autocomplete="off"
                                         value="#{loginController.username}"/>
                        </div>
                        <div class="form-group">
                            <span>Password</span>
                            <p:password placeholder="escribe tu password..."
                                        value="#{loginController.password}"/>
                        </div>
                        <div class="form-footer">
                            <p:commandButton value="INGRESAR"
                                             action="#{loginController.loginEncrypt()}" update="growl"/>
                            <p:commandButton
                                    styleClass="ui-button-info ui-button-flat mr-2 mb-2"
                                    action="#{loginController.prepararReset}"
                                    update=":loginForm:manage-pass"
                                    value="¿Olvidaste tu contraseña?" type="button"
                                    onclick="PF('dlgProcesarReseteo').show()">
                            </p:commandButton>
                        </div>

                        <p:dialog id="manage-pass" header="Solicitar Código de Verificación"
                                  widgetVar="dlgProcesarReseteo" minHeight="40" width="550"
                                  showEffect="fade" modal="true">

                            <h:panelGroup id="dlgContent" class="ui-fluid">
                                <div class="field">
                                    <p:outputLabel class="mb-5"
                                                   rendered="#{not loginController.campoVerificacionVisible}">
                                        Ingresa tu correo electronico
                                    </p:outputLabel>
                                    <p:inputText id="correo"
                                                 style="margin-top: 2rem !important;"
                                                 rendered="#{not loginController.campoVerificacionVisible}"
                                                 required="true"
                                                 validatorMessage="El formato del correo no es válido"
                                                 value="#{loginController.correoParaRecuperacion}"
                                                 placeholder="correo@correo.com" autocomplete="off">
                                        <f:validateRegex
                                                pattern="^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$"/>
                                    </p:inputText>
                                    <p:message for="correo"/>
                                </div>

                                <div class="field">
                                    <p:outputLabel rendered="#{loginController.campoVerificacionVisible}">
                                        Ingresa el codigo que recibiste
                                    </p:outputLabel>
                                    <p:inputText style="margin-top: 2rem !important;"
                                                 rendered="#{loginController.campoVerificacionVisible}"
                                                 value="#{loginController.token}"
                                                 placeholder="escribe tu codigo de verificacion" autocomplete="off"/>

                                </div>
                            </h:panelGroup>

                            <f:facet name="footer">
                                <h:panelGroup id="panel-botones">
                                    <p:commandButton id="btnValidar" value="Validar" icon="pi pi-check"
                                                     rendered="#{loginController.campoVerificacionVisible}"
                                                     action="#{loginController.validarCodigoSeguridad()}"
                                                     process="@this :loginForm:dlgContent"
                                                     update=":loginForm :growl"
                                                     oncomplete="PF('dlgProcesarReseteo').hide()"/>

                                    <p:commandButton id="btnEnviar" value="Enviar" icon="pi pi-check"
                                                     rendered="#{not loginController.campoVerificacionVisible}"
                                                     process="@this :loginForm:dlgContent"
                                                     action="#{loginController.procesarCambioPassword()}"
                                                     update=":loginForm:dlgContent :loginForm:panel-botones :growl"/>
                                </h:panelGroup>
                            </f:facet>
                        </p:dialog>

                        <p:dialog header="Cambiar contraseña" widgetVar="dlgCambiarPassword"
                                  minHeight="40" width="350" showEffect="fade">
                            <p:outputPanel id="manage-reset" class="ui-fluid">
                                <div class="field">
                                    <p:outputLabel for="pwd1">Nueva Contraseña</p:outputLabel>
                                    <p:password id="pwd1"
                                                value="#{loginController.newPassword}"
                                                required="true" toggleMask="true">
                                    </p:password>
                                    <p:message for="pwd1"/>
                                </div>

                                <div class="field" style="margin-top:2rem">
                                    <p:outputLabel for="pwd2">Confirma Contraseña</p:outputLabel>
                                    <p:password id="pwd2"
                                                value="#{loginController.confirmPassword}"
                                                required="true" toggleMask="true"/>
                                </div>
                            </p:outputPanel>

                            <f:facet name="footer">
                                <p:commandButton value="Guardar" icon="pi pi-check"
                                                 process="@this :loginForm:pwd1 :loginForm:pwd2"
                                                 update=":growl"
                                                 oncomplete="if (args &amp;&amp; !args.validationFailed) PF('confirmarDialog').show()"/>
                            </f:facet>
                        </p:dialog>

                        <!-- confirms -->
                        <p:confirmDialog global="true" widgetVar="confirmarDialog" showEffect="fade"
                                         modal="false" width="300"
                                         message="Esta seguro que desea resetear la contraseña?"
                                         header="Confirmacion">
                            <p:commandButton value="Si" icon="pi pi-check" update=":growl"
                                             actionListener="#{loginController.updatePasswordUserLogged()}"
                                             oncomplete="PF('confirmarDialog').hide()"/>
                            <p:commandButton value="No" type="button" update=":loginForm"
                                             styleClass="ui-button-secondary" icon="pi pi-times"
                                             onclick="PF('confirmarDialog').hide()"/>
                        </p:confirmDialog>
                    </div>
                </div>

            </h:form>
        </div>
        <div class="login-image"></div>
    </div>

    <h:outputStylesheet
            name="css/layout-#{guestPreferences.layoutPrimaryColor}.css"
            library="pandora-layout"/>
</h:body>

</html>